webpackJsonp([3],{"7pSd":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),r=a("Xxa5"),o=a.n(r),i=a("exGp"),c=a.n(i),u=a("ZEg/"),l=a("SgTw"),p={name:"base-coupon",props:{couponDetail:{type:Object,require:!0}},data:function(){return{config:l.a,requestParams:null,couponCacheUrl:null,couponFile:null}},computed:{logoUrl:function(){return this.couponCacheUrl?this.couponCacheUrl:this.couponDetail.picture?""+this.config.DOWNLOAD_URL+this.couponDetail.picture:null}},created:function(){this.requestParams=this.couponDetail},watch:{couponDetail:{handler:function(e){console.log(e,1233),this.requestParams=e},deep:!0}},methods:{saveHandle:function(){var e=this;return c()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.modifyCoupon(e.requestParams);case 2:"success"===(a=t.sent).flags?(e.$toast("修改成功，立即生效","success"),e.$emit("callback")):e.$toast(a.message,"error");case 4:case"end":return t.stop()}},t,e)}))()},getCacheFile:function(e){console.log(e.target,"获取上传文件信息");var t=e.target.files[0];this.couponCacheUrl=this.getObjectURL(t),this.couponFile=t,this.couponFile&&this.$toast("请点击“上传产品图”按钮以完成上传","info")},getObjectURL:function(e){var t=null;return window.createObjectURL?t=window.createObjectURL(e):window.URL?t=window.URL.createObjectURL(e):window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},upload:function(){var e=this;return c()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.couponFile){t.next=2;break}return t.abrupt("return",e.$toast("请浏览图片后上传"));case 2:return t.next=4,u.a.upload(e.couponFile,{couponkey:e.requestParams.couponkey},"/mcp");case 4:"success"===(a=t.sent).flags?(e.couponDetail.picture=a.data.picpath,e.$toast("上传图片成功","success")):e.$toast(a.message,"error");case 6:case"end":return t.stop()}},t,e)}))()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"base-coupon"},[a("div",{staticClass:"base-coupon_upload"},[a("div",{staticClass:"file-box"},[e.couponDetail.picture||e.couponCacheUrl?a("img",{attrs:{width:"100%",height:"100%",src:e.logoUrl}}):e._e()]),e._v(" "),a("input",{staticStyle:{visibility:"hidden",width:"0",height:"0"},attrs:{type:"file",accept:"image/png,image/jpeg,image/gif",name:"file",id:"file_"+e.couponDetail.couponid},on:{change:e.getCacheFile}}),e._v(" "),a("label",{attrs:{for:"file_"+e.couponDetail.couponid}},[a("span",{staticStyle:{"font-size":"14px",color:"#409EFF",cursor:"pointer"}},[e._v("浏览..")])]),e._v(" "),a("el-button",{staticClass:"upload-btn",attrs:{type:"primary",size:"small",round:""},on:{click:e.upload}},[e._v("上传产品图")])],1),e._v(" "),a("div",{staticClass:"base-coupon_form"},[a("p",[e._v("礼券名称：\n      "),a("el-input",{staticStyle:{width:"50%","margin-right":"5px"},attrs:{size:"small",maxlength:"30"},model:{value:e.requestParams.name,callback:function(t){e.$set(e.requestParams,"name",t)},expression:"requestParams.name"}}),e._v(" "),a("span",[e._v(" 礼券ID:")]),e._v(" "+e._s(e.requestParams.couponid)+"\n    ")],1),e._v(" "),a("p",[e._v("当前折扣：\n      "),a("el-input",{staticStyle:{width:"50px"},attrs:{size:"small",maxlength:"2"},model:{value:e.requestParams.discount,callback:function(t){e.$set(e.requestParams,"discount",t)},expression:"requestParams.discount"}})],1),e._v(" "),a("p",[e._v("下一折扣日期：\n      "),a("el-date-picker",{attrs:{size:"small",type:"date",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd",placeholder:"选择日期"},model:{value:e.requestParams.nextdiscountdate,callback:function(t){e.$set(e.requestParams,"nextdiscountdate",t)},expression:"requestParams.nextdiscountdate"}})],1),e._v(" "),a("p",[e._v("下一折扣：\n      "),a("el-input",{staticStyle:{width:"50px"},attrs:{size:"small",maxlength:"2"},model:{value:e.requestParams.nextdiscount,callback:function(t){e.$set(e.requestParams,"nextdiscount",t)},expression:"requestParams.nextdiscount"}})],1),e._v(" "),a("p",[e._v("原价：\n      "),a("el-input",{staticStyle:{width:"105px"},attrs:{size:"small"},model:{value:e.requestParams.value,callback:function(t){e.$set(e.requestParams,"value",t)},expression:"requestParams.value"}}),e._v(" 元\n    ")],1),e._v(" "),a("p",[e._v("上架时间：\n      "),a("el-date-picker",{attrs:{size:"small",type:"date",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd",placeholder:"选择日期"},model:{value:e.requestParams.timeon,callback:function(t){e.$set(e.requestParams,"timeon",t)},expression:"requestParams.timeon"}})],1),e._v(" "),a("p",[e._v("下架时间：\n      "),a("el-date-picker",{attrs:{size:"small",type:"date",format:"yyyy/MM/dd","value-format":"yyyy/MM/dd",placeholder:"选择日期"},model:{value:e.requestParams.timeoff,callback:function(t){e.$set(e.requestParams,"timeoff",t)},expression:"requestParams.timeoff"}})],1),e._v(" "),a("el-button",{staticClass:"confirm",attrs:{type:"primary",size:"small",round:""},on:{click:e.saveHandle}},[e._v("保存修改")])],1)])},staticRenderFns:[]};var m={name:"index",components:{baseCoupon:a("VU/8")(p,d,!1,function(e){a("ZISd")},"data-v-7ba90133",null).exports},data:function(){return{requestParams:{name:null},couponList:[]}},created:function(){this.getCouponList()},methods:{createCouponHandle:function(){var e=this;return c()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.requestParams.name){t.next=2;break}return t.abrupt("return",e.$toast("请输入礼券名称！"));case 2:return t.next=4,u.a.createCoupon(e.requestParams);case 4:"success"===(a=t.sent).flags?(e.$toast("礼券创建成功!","success"),e.getCouponList()):e.$toast(a.message,"error");case 6:case"end":return t.stop()}},t,e)}))()},getCouponList:function(){var e=this;return c()(o.a.mark(function t(){var a,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return delete(a=JSON.parse(n()(e.requestParams))).name,t.next=4,u.a.getCouponList(a);case 4:"success"===(s=t.sent).flags?s.data&&s.data.length&&(e.couponList=s.data):e.$toast(s.message,"error");case 6:case"end":return t.stop()}},t,e)}))()},updateCouponList:function(){this.requestParams.name=null,this.getCouponList()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"coupon"},[a("div",{staticClass:"coupon_header"},[a("el-input",{attrs:{size:"small",placeholder:"礼券名称",maxlength:"30"},model:{value:e.requestParams.name,callback:function(t){e.$set(e.requestParams,"name",t)},expression:"requestParams.name"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:e.createCouponHandle}},[e._v("创建礼券")])],1),e._v(" "),a("div",{staticClass:"coupon_content"},e._l(e.couponList,function(t){return e.couponList.length?a("div",{staticClass:"fl"},[a("base-coupon",{attrs:{"coupon-detail":t},on:{callback:e.updateCouponList}})],1):e._e()}),0)])},staticRenderFns:[]};var v=a("VU/8")(m,f,!1,function(e){a("sHOU")},"data-v-dbf4e892",null);t.default=v.exports},ZISd:function(e,t){},sHOU:function(e,t){}});
//# sourceMappingURL=3.6cba6286efaac65d7fc1.js.map