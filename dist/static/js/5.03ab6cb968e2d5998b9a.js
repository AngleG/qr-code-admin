webpackJsonp([5],{"0Pfg":function(e,t){},jrjG:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),r=a.n(n),s=a("woOf"),o=a.n(s),u=a("exGp"),c=a.n(u),i=a("//Fk"),l=a.n(i),p=a("ZEg/"),m=a("1nEv"),f={data:function(){var e=this;this.$createElement;return{configObject:{COUPON_STATUS:m.b,couponList:[],dealerList:[]},searchParams:{couponkey:null,pagenum:0},requestParams:{agentcompanykey:null,sharedData:{serialfrom:null,num:null}},tableColumns:[{title:"时间",width:160,align:"center",key:"time"},{title:"起始编号",align:"center",key:"sfrom"},{title:"终止编号",align:"center",key:"sto"},{title:"经销商",align:"center",key:"agentcompanyname"},{title:"事件",align:"center",key:"action",render:function(t,a){return t("span",[e.$options.filters.formatConfigValueToLabel(a.row.action,e.configObject.COUPON_STATUS)])}},{title:"成功张数",align:"center",key:"successnum"},{title:"失败张数",align:"center",key:"failnum"}],tableData:[],isLoading:!1,totalPages:0}},created:function(){var e=this;l.a.all([this.getDealerList(),this.getCouponList()]).then(function(){e.getCouponOperatingList()}).catch(function(e){return console.log(e)})},methods:{getDealerList:function(){var e=this;return c()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getDealerList();case 2:"success"===(a=t.sent).flags?(e.configObject.dealerList=[],a.data&&a.data.length&&(e.configObject.dealerList=a.data.map(function(e){return o()(e,{label:e.name,value:e.companykey})}),e.requestParams.agentcompanykey=e.configObject.dealerList[0].value||null)):e.$toast(a.message,"error");case 4:case"end":return t.stop()}},t,e)}))()},getCouponList:function(){var e=this;return c()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.a.getCouponList({});case 2:"success"===(a=t.sent).flags?(e.configObject.couponList=[],a.data&&a.data.length&&(e.configObject.couponList=a.data.reverse().map(function(e){return{label:e.name,value:e.couponkey}}),e.searchParams.couponkey=e.configObject.couponList[0].value||null)):e.$toast(a.message,"error");case 4:case"end":return t.stop()}},t,e)}))()},getCouponOperatingList:function(e){var t=this;return c()(r.a.mark(function a(){var n,s;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.isLoading=!0,(n=t.$_.cloneDeep(t.searchParams)).pagenum="number"==typeof e?e:0,a.next=5,p.a.getCouponOperatingList(n);case 5:"success"===(s=a.sent).flags?(t.tableData=[],t.totalPages=0,s.data&&(t.totalPages=s.data.totalpages,t.tableData=s.data.list)):t.$toast(s.message,"error"),t.isLoading=!1;case 8:case"end":return a.stop()}},a,t)}))()},setCouponStatus:function(e){var t=this;return c()(r.a.mark(function a(){var n,s,u,c,i,l,m,f,g;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return",t.$toast("礼劵状态不能为空"));case 2:if(s=(n="cancel"===e)?"撤销":"激活",u=t.$_.cloneDeep(t.requestParams.sharedData),i=(c=u).serialfrom,l=c.num,m=t.requestParams.agentcompanykey,f=t.searchParams.couponkey){a.next=10;break}return a.abrupt("return",t.$toast("请选择礼劵后"+s));case 10:if(u=o()(u,{couponkey:f}),m){a.next=13;break}return a.abrupt("return",t.$toast("请选择经销商后"+s));case 13:if(null!==i&&""!==i&&null!==l&&""!==l){a.next=15;break}return a.abrupt("return",t.$toast("起始序列号和张数不能为空"));case 15:if(u.serialfrom=i-=0,u.num=l-=0,"number"==typeof i&&"number"==typeof l){a.next=19;break}return a.abrupt("return",t.$toast("起始序列号和张数必须为数字"));case 19:if(!(i<1)){a.next=21;break}return a.abrupt("return",t.$toast(s+"起始序列号必须大于或等于1"));case 21:if(!(l<0||l>1e3)){a.next=23;break}return a.abrupt("return",t.$toast(s+"张数必须大于0且小于或等于1000"));case 23:if(!n){a.next=29;break}return a.next=26,p.a.setCouponForCancel(u);case 26:a.t0=a.sent,a.next=32;break;case 29:return a.next=31,p.a.setCouponForActivation(u);case 31:a.t0=a.sent;case 32:"success"===(g=a.t0).flags?t.setCouponStatusConfirm(g.data,u,n):t.$toast(g.message,"error");case 34:case"end":return a.stop()}},a,t)}))()},enterCouponStatus:function(e,t,a){var n=this;return c()(r.a.mark(function s(){var u,c,i;return r.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return u=n.requestParams.agentcompanykey,c=o()({},{couponkey:e.couponkey,action:e.action},{serialfrom:t.serialfrom,num:t.num,agentcompanykey:u}),r.next=4,p.a.enterCouponStatus(c);case 4:"success"===(i=r.sent).flags?(n.$toast((a?"撤销":"激活")+"成功","success"),n.getCouponOperatingList(0)):n.$toast(i.message,"error");case 6:case"end":return r.stop()}},s,n)}))()},setCouponStatusConfirm:function(e,t,a){var n=this;this.$confirm("请确认"+e.serialfrom+"到"+e.serialto+"范围内第一张支付码"+e.codestart+"的序列号为"+e.serialfrom+"，最后一张支付码"+e.codelast+"的序列号为"+e.serialto+"，是否确认"+(a?"撤销":"激活")+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",roundButton:!0,type:"warning"}).then(function(){return n.enterCouponStatus(e,t,a)}).catch(function(){})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"coupon-operating"},[a("div",{staticClass:"coupon-operating_search"},[a("el-select",{attrs:{size:"small",value:e.searchParams.couponkey,placeholder:"请选择礼劵"},on:{change:e.getCouponOperatingList},model:{value:e.searchParams.couponkey,callback:function(t){e.$set(e.searchParams,"couponkey",t)},expression:"searchParams.couponkey"}},e._l(e.configObject.couponList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-select",{staticStyle:{"margin-left":"20px"},attrs:{size:"small",value:e.requestParams.agentcompanykey,placeholder:"请选择经销商"},model:{value:e.requestParams.agentcompanykey,callback:function(t){e.$set(e.requestParams,"agentcompanykey",t)},expression:"requestParams.agentcompanykey"}},e._l(e.configObject.dealerList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("base-item",{attrs:{inline:""}},[a("template",{slot:"label"},[e._v("起始序列号:")]),a("el-input",{attrs:{size:"small"},model:{value:e.requestParams.sharedData.serialfrom,callback:function(t){e.$set(e.requestParams.sharedData,"serialfrom",t)},expression:"requestParams.sharedData.serialfrom"}})],2),e._v(" "),a("base-item",{attrs:{"label-width":"45px",inline:""}},[a("template",{slot:"label"},[e._v("张数:")]),a("el-input",{attrs:{size:"small"},model:{value:e.requestParams.sharedData.num,callback:function(t){e.$set(e.requestParams.sharedData,"num",t)},expression:"requestParams.sharedData.num"}}),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",round:""},on:{click:function(t){return e.setCouponStatus("activation")}}},[e._v("激活")]),a("el-button",{attrs:{size:"small",type:"primary",round:""},on:{click:function(t){return e.setCouponStatus("cancel")}}},[e._v("撤销")])],2)],1),e._v(" "),a("div",{staticClass:"coupon-operating_content"},[a("element-table",{attrs:{"table-columns":e.tableColumns,"table-data":e.tableData,"element-loading-background":"rgba(0, 0, 0, 0.5)"}}),e._v(" "),a("customize-pagination",{attrs:{"page-count":e.totalPages},on:{getList:e.getCouponOperatingList}})],1)])},staticRenderFns:[]};var b=a("VU/8")(f,g,!1,function(e){a("0Pfg")},"data-v-f335cc76",null);t.default=b.exports}});
//# sourceMappingURL=5.03ab6cb968e2d5998b9a.js.map